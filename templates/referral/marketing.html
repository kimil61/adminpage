{% extends "base.html" %}

{% block title %}μ¶”μ²μΈ λ§μΌ€ν… λ„κµ¬{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- ν—¤λ” -->
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">μ¶”μ²μΈ λ§μΌ€ν… λ„κµ¬</h1>
                <p class="text-gray-600">μΉκµ¬λ¥Ό μ΄λ€ν•  μ μλ” λ‹¤μ–‘ν• λ§μΌ€ν… λ„κµ¬λ¥Ό ν™μ©ν•μ„Έμ”</p>
            </div>
            <a href="/referral/dashboard" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                <i class="fas fa-arrow-left"></i> λ€μ‹λ³΄λ“λ΅
            </a>
        </div>
    </div>

    {% if not referral_info.has_referral %}
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-8">
        <div class="flex items-center">
            <i class="fas fa-exclamation-triangle text-yellow-600 mr-3"></i>
            <div>
                <h3 class="text-lg font-semibold text-yellow-900">μ¶”μ²μΈ μ½”λ“κ°€ ν•„μ”ν•©λ‹λ‹¤</h3>
                <p class="text-yellow-700">λ§μΌ€ν… λ„κµ¬λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ λ¨Όμ € μ¶”μ²μΈ μ½”λ“λ¥Ό μƒμ„±ν•΄μ£Όμ„Έμ”.</p>
            </div>
        </div>
        <div class="mt-4">
            <a href="/referral/dashboard" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700">
                μ¶”μ²μΈ μ½”λ“ μƒμ„±ν•κΈ°
            </a>
        </div>
    </div>
    {% else %}
    <!-- μ¶”μ²μΈ μ½”λ“ κ³µμ  -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">μ¶”μ²μΈ μ½”λ“ κ³µμ </h2>
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200 rounded-lg p-6">
            <div class="flex items-center space-x-4 mb-4">
                <div class="bg-white border-2 border-blue-300 rounded-lg px-4 py-3 flex-1">
                    <span class="text-2xl font-mono font-bold text-blue-600" id="referralCode">{{ referral_info.referral_code }}</span>
                </div>
                <button onclick="copyReferralCode()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                    <i class="fas fa-copy"></i> λ³µμ‚¬
                </button>
            </div>
            <p class="text-sm text-gray-600">μ΄ μ½”λ“λ¥Ό μΉκµ¬μ—κ² κ³µμ ν•μ„Έμ”!</p>
        </div>
    </div>

    <!-- λ§μΌ€ν… λ„κµ¬λ“¤ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- μ§μ ‘ λ§ν¬ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-link text-blue-600"></i> μ§μ ‘ λ§ν¬
            </h3>
            <p class="text-gray-600 mb-4">μΉκµ¬μ—κ² μ§μ ‘ μ „λ‹¬ν•  μ μλ” λ§ν¬μ…λ‹λ‹¤.</p>
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4">
                <span class="text-sm font-mono text-gray-700" id="directLink">{{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}</span>
            </div>
            <button onclick="copyDirectLink()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                <i class="fas fa-copy"></i> λ§ν¬ λ³µμ‚¬
            </button>
        </div>

        <!-- QR μ½”λ“ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-qrcode text-green-600"></i> QR μ½”λ“
            </h3>
            <p class="text-gray-600 mb-4">μ¤λ§νΈν°μΌλ΅ μ¤μΊ”ν•μ—¬ λ°”λ΅ μ ‘μ†ν•  μ μμµλ‹λ‹¤.</p>
            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4 mb-4 flex justify-center">
                <div id="qrcode" class="w-32 h-32"></div>
            </div>
            <button onclick="downloadQRCode()" class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                <i class="fas fa-download"></i> QR μ½”λ“ λ‹¤μ΄λ΅λ“
            </button>
        </div>

        <!-- μ†μ… λ―Έλ””μ–΄ κ³µμ  -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-share-alt text-purple-600"></i> μ†μ… λ―Έλ””μ–΄ κ³µμ 
            </h3>
            <p class="text-gray-600 mb-4">μ†μ… λ―Έλ””μ–΄μ— μ¶”μ²μΈ μ½”λ“λ¥Ό κ³µμ ν•μ„Έμ”.</p>
            <div class="space-y-3">
                <button onclick="shareToKakao()" class="w-full bg-yellow-400 text-black px-4 py-2 rounded-lg hover:bg-yellow-500">
                    <i class="fas fa-comment"></i> μΉ΄μΉ΄μ¤ν†΅ κ³µμ 
                </button>
                <button onclick="shareToFacebook()" class="w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                    <i class="fab fa-facebook"></i> νμ΄μ¤λ¶ κ³µμ 
                </button>
                <button onclick="shareToTwitter()" class="w-full bg-blue-400 text-white px-4 py-2 rounded-lg hover:bg-blue-500">
                    <i class="fab fa-twitter"></i> νΈμ„ν„° κ³µμ 
                </button>
            </div>
        </div>

        <!-- μ΄λ©”μΌ ν…ν”λ¦Ώ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                <i class="fas fa-envelope text-red-600"></i> μ΄λ©”μΌ ν…ν”λ¦Ώ
            </h3>
            <p class="text-gray-600 mb-4">μ΄λ©”μΌλ΅ μΉκµ¬λ¥Ό μ΄λ€ν•  μ μλ” ν…ν”λ¦Ώμ…λ‹λ‹¤.</p>
            <div class="space-y-3">
                <button onclick="copyEmailTemplate()" class="w-full bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700">
                    <i class="fas fa-copy"></i> μ΄λ©”μΌ ν…ν”λ¦Ώ λ³µμ‚¬
                </button>
                <button onclick="openEmailClient()" class="w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                    <i class="fas fa-envelope-open"></i> μ΄λ©”μΌ ν΄λΌμ΄μ–ΈνΈ μ—΄κΈ°
                </button>
            </div>
        </div>
    </div>

    <!-- κ³µμ  λ©”μ‹μ§€ ν…ν”λ¦Ώ -->
    <div class="mt-8 bg-white rounded-lg shadow p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">
            <i class="fas fa-comment-dots text-indigo-600"></i> κ³µμ  λ©”μ‹μ§€ ν…ν”λ¦Ώ
        </h3>
        <p class="text-gray-600 mb-4">λ‹¤μ–‘ν• μƒν™©μ— λ§λ” κ³µμ  λ©”μ‹μ§€λ¥Ό μ¤€λΉ„ν–μµλ‹λ‹¤.</p>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- μΉκµ¬ μ΄λ€ λ©”μ‹μ§€ -->
            <div>
                <h4 class="font-medium text-gray-900 mb-2">μΉκµ¬ μ΄λ€ λ©”μ‹μ§€</h4>
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-3">
                    <p class="text-sm text-gray-700" id="friendMessage">
μ•λ…•ν•μ„Έμ”! π‰

μ €ν¬ μ‚¬μ΄νΈμ—μ„ μ •λ§ μ μ©ν• μ„λΉ„μ¤λ¥Ό μ΄μ©ν•κ³  μλ”λ°, 
μΉκµ¬λ¶„λ„ ν•¨κ» μ΄μ©ν•μ‹λ©΄ μΆ‹μ„ κ²ƒ κ°™μ•„μ„ μ¶”μ²λ“λ ¤μ”!

μ  μ¶”μ²μΈ μ½”λ“λ΅ κ°€μ…ν•μ‹λ©΄ λ°”λ΅ 1,000ν¬μΈνΈλ¥Ό λ°›μΌμ‹¤ μ μμ–΄μ”.
μ¶”μ²μΈ μ½”λ“: {{ referral_info.referral_code }}

κ°€μ… λ§ν¬: {{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}

ν•¨κ» μ΄μ©ν•΄λ³΄μ„Έμ”! π
                    </p>
                </div>
                <button onclick="copyFriendMessage()" class="w-full bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                    <i class="fas fa-copy"></i> λ©”μ‹μ§€ λ³µμ‚¬
                </button>
            </div>

            <!-- SNS κ³µμ  λ©”μ‹μ§€ -->
            <div>
                <h4 class="font-medium text-gray-900 mb-2">SNS κ³µμ  λ©”μ‹μ§€</h4>
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-3">
                    <p class="text-sm text-gray-700" id="snsMessage">
π μΉκµ¬ μ¶”μ² μ΄λ²¤νΈ! π

μ •λ§ μΆ‹μ€ μ„λΉ„μ¤λ¥Ό λ°κ²¬ν–μ–΄μ”!
μ  μ¶”μ²μΈ μ½”λ“λ΅ κ°€μ…ν•μ‹λ©΄ λ°”λ΅ 1,000ν¬μΈνΈ μ§€κΈ‰!

μ¶”μ²μΈ μ½”λ“: {{ referral_info.referral_code }}

κ°€μ… λ§ν¬: {{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}

#μ¶”μ²μΈ #ν¬μΈνΈ #μ΄λ²¤νΈ
                    </p>
                </div>
                <button onclick="copySNSMessage()" class="w-full bg-pink-600 text-white px-4 py-2 rounded-lg hover:bg-pink-700">
                    <i class="fas fa-copy"></i> λ©”μ‹μ§€ λ³µμ‚¬
                </button>
            </div>
        </div>
    </div>

    <!-- λ³΄μƒ μ •μ±… μ•λ‚΄ -->
    <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-blue-900 mb-4">
            <i class="fas fa-gift"></i> μ¶”μ²μΈ λ³΄μƒ μ •μ±…
        </h3>
        <div class="grid md:grid-cols-2 gap-6">
            <div>
                <h4 class="font-medium text-blue-900 mb-2">κ°€μ… λ³΄μƒ</h4>
                <ul class="text-sm text-blue-800 space-y-1">
                    <li>β€Ά μΉκµ¬κ°€ μ¶”μ²μΈ μ½”λ“λ΅ κ°€μ… μ‹: <strong>1,000P</strong></li>
                    <li>β€Ά μ¦‰μ‹ μ§€κΈ‰λ©λ‹λ‹¤</li>
                    <li>β€Ά 1μΈλ‹Ή 1νλ§ μ§€κΈ‰λ©λ‹λ‹¤</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium text-blue-900 mb-2">κµ¬λ§¤ λ³΄μƒ</h4>
                <ul class="text-sm text-blue-800 space-y-1">
                    <li>β€Ά μ¶”μ²λ°›μ€ μΉκµ¬κ°€ κµ¬λ§¤ μ‹: <strong>κµ¬λ§¤κΈμ•΅μ 5%</strong></li>
                    <li>β€Ά μµλ€ 5,000PκΉμ§€ μ§€κΈ‰</li>
                    <li>β€Ά μ›” 1νκΉμ§€ μ§€κΈ‰λ©λ‹λ‹¤</li>
                </ul>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- QR μ½”λ“ λΌμ΄λΈλ¬λ¦¬ -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

<script>
// μ¶”μ²μΈ μ½”λ“ λ³µμ‚¬
function copyReferralCode() {
    const code = document.getElementById('referralCode').textContent;
    copyToClipboard(code, 'μ¶”μ²μΈ μ½”λ“κ°€ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
}

// μ§μ ‘ λ§ν¬ λ³µμ‚¬
function copyDirectLink() {
    const link = document.getElementById('directLink').textContent;
    copyToClipboard(link, 'μ§μ ‘ λ§ν¬κ°€ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
}

// μΉκµ¬ λ©”μ‹μ§€ λ³µμ‚¬
function copyFriendMessage() {
    const message = document.getElementById('friendMessage').textContent;
    copyToClipboard(message, 'μΉκµ¬ μ΄λ€ λ©”μ‹μ§€κ°€ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
}

// SNS λ©”μ‹μ§€ λ³µμ‚¬
function copySNSMessage() {
    const message = document.getElementById('snsMessage').textContent;
    copyToClipboard(message, 'SNS κ³µμ  λ©”μ‹μ§€κ°€ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
}

// μ΄λ©”μΌ ν…ν”λ¦Ώ λ³µμ‚¬
function copyEmailTemplate() {
    const subject = 'μ¶”μ²μΈ μ΄λ€ - μ •λ§ μΆ‹μ€ μ„λΉ„μ¤λ¥Ό λ°κ²¬ν–μ–΄μ”!';
    const body = `μ•λ…•ν•μ„Έμ”!

μ •λ§ μ μ©ν• μ„λΉ„μ¤λ¥Ό μ΄μ©ν•κ³  μλ”λ°, μΉκµ¬λ¶„λ„ ν•¨κ» μ΄μ©ν•μ‹λ©΄ μΆ‹μ„ κ²ƒ κ°™μ•„μ„ μ¶”μ²λ“λ ¤μ”!

μ  μ¶”μ²μΈ μ½”λ“λ΅ κ°€μ…ν•μ‹λ©΄ λ°”λ΅ 1,000ν¬μΈνΈλ¥Ό λ°›μΌμ‹¤ μ μμ–΄μ”.

μ¶”μ²μΈ μ½”λ“: {{ referral_info.referral_code }}
κ°€μ… λ§ν¬: {{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}

ν•¨κ» μ΄μ©ν•΄λ³΄μ„Έμ”!

κ°μ‚¬ν•©λ‹λ‹¤.`;

    const emailContent = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    copyToClipboard(emailContent, 'μ΄λ©”μΌ ν…ν”λ¦Ώμ΄ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
}

// μ΄λ©”μΌ ν΄λΌμ΄μ–ΈνΈ μ—΄κΈ°
function openEmailClient() {
    const subject = 'μ¶”μ²μΈ μ΄λ€ - μ •λ§ μΆ‹μ€ μ„λΉ„μ¤λ¥Ό λ°κ²¬ν–μ–΄μ”!';
    const body = `μ•λ…•ν•μ„Έμ”!

μ •λ§ μ μ©ν• μ„λΉ„μ¤λ¥Ό μ΄μ©ν•κ³  μλ”λ°, μΉκµ¬λ¶„λ„ ν•¨κ» μ΄μ©ν•μ‹λ©΄ μΆ‹μ„ κ²ƒ κ°™μ•„μ„ μ¶”μ²λ“λ ¤μ”!

μ  μ¶”μ²μΈ μ½”λ“λ΅ κ°€μ…ν•μ‹λ©΄ λ°”λ΅ 1,000ν¬μΈνΈλ¥Ό λ°›μΌμ‹¤ μ μμ–΄μ”.

μ¶”μ²μΈ μ½”λ“: {{ referral_info.referral_code }}
κ°€μ… λ§ν¬: {{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}

ν•¨κ» μ΄μ©ν•΄λ³΄μ„Έμ”!

κ°μ‚¬ν•©λ‹λ‹¤.`;

    window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

// μ†μ… λ―Έλ””μ–΄ κ³µμ 
function shareToKakao() {
    const text = `π μΉκµ¬ μ¶”μ² μ΄λ²¤νΈ! π\n\nμ •λ§ μΆ‹μ€ μ„λΉ„μ¤λ¥Ό λ°κ²¬ν–μ–΄μ”!\nμ  μ¶”μ²μΈ μ½”λ“λ΅ κ°€μ…ν•μ‹λ©΄ λ°”λ΅ 1,000ν¬μΈνΈ μ§€κΈ‰!\n\nμ¶”μ²μΈ μ½”λ“: {{ referral_info.referral_code }}\nκ°€μ… λ§ν¬: {{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}`;
    
    if (navigator.share) {
        navigator.share({
            title: 'μ¶”μ²μΈ μ΄λ€',
            text: text,
            url: '{{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}'
        });
    } else {
        copyToClipboard(text, 'μΉ΄μΉ΄μ¤ν†΅ κ³µμ  λ©”μ‹μ§€κ°€ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
    }
}

function shareToFacebook() {
    const url = '{{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}';
    window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
}

function shareToTwitter() {
    const text = 'π μΉκµ¬ μ¶”μ² μ΄λ²¤νΈ! μ  μ¶”μ²μΈ μ½”λ“λ΅ κ°€μ…ν•μ‹λ©΄ 1,000ν¬μΈνΈ μ§€κΈ‰!';
    const url = '{{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}';
    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
}

// QR μ½”λ“ μƒμ„±
function generateQRCode() {
    const link = '{{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}';
    QRCode.toCanvas(document.getElementById('qrcode'), link, {
        width: 128,
        margin: 2
    }, function (error) {
        if (error) console.error(error);
    });
}

// QR μ½”λ“ λ‹¤μ΄λ΅λ“
function downloadQRCode() {
    const link = '{{ request.base_url }}auth/register?ref={{ referral_info.referral_code }}';
    QRCode.toDataURL(link, {
        width: 256,
        margin: 2
    }, function (error, url) {
        if (error) {
            console.error(error);
            return;
        }
        
        const a = document.createElement('a');
        a.download = 'referral-qr-code.png';
        a.href = url;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    });
}

// ν΄λ¦½λ³΄λ“ λ³µμ‚¬ μ ν‹Έλ¦¬ν‹°
function copyToClipboard(text, message) {
    navigator.clipboard.writeText(text).then(() => {
        alert(message);
    }).catch(() => {
        // ν΄λ°±: ν…μ¤νΈ μ„ νƒ
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert(message);
    });
}

// νμ΄μ§€ λ΅λ“ μ‹ QR μ½”λ“ μƒμ„±
document.addEventListener('DOMContentLoaded', function() {
    {% if referral_info.has_referral %}
    generateQRCode();
    {% endif %}
});
</script>
{% endblock %} 