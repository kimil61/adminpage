{% extends "base.html" %}

{% block title %}ìš´ì„¸ ìƒì  - ìƒí’ˆ ëª©ë¡{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- í—¤ë” -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">ìš´ì„¸ ìƒì </h1>
        <p class="text-gray-600">AI ê¸°ë°˜ ì •í™•í•œ ìš´ì„¸ ë¶„ì„ì„ ë§Œë‚˜ë³´ì„¸ìš”</p>
    </div>

    <!-- ì‚¬ìš©ì í¬ì¸íŠ¸ í‘œì‹œ -->
    {% if current_user %}
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
        <div class="flex items-center justify-between">
            <div>
                <span class="text-sm text-blue-600">ë³´ìœ  í¬ì¸íŠ¸</span>
                <span class="ml-2 text-lg font-bold text-blue-800">{{ "{:,}".format(user_points) }}P</span>
            </div>
            <a href="/fortune/charge" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700">
                í¬ì¸íŠ¸ ì¶©ì „
            </a>
        </div>
    </div>
    {% endif %}

    <!-- í•„í„° ë° ê²€ìƒ‰ -->
    <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
        <form method="GET" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <!-- ê²€ìƒ‰ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ê²€ìƒ‰</label>
                    <input type="text" name="search" value="{{ search or '' }}" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="ìƒí’ˆëª… ë˜ëŠ” ì„¤ëª…">
                </div>
                
                <!-- ì¹´í…Œê³ ë¦¬ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì¹´í…Œê³ ë¦¬</label>
                    <select name="category" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">ì „ì²´</option>
                        <option value="saju" {% if category == 'saju' %}selected{% endif %}>ì‚¬ì£¼</option>
                        <option value="tarot" {% if category == 'tarot' %}selected{% endif %}>íƒ€ë¡œ</option>
                        <option value="fortune" {% if category == 'fortune' %}selected{% endif %}>ìš´ì„¸</option>
                    </select>
                </div>
                
                <!-- ì •ë ¬ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">ì •ë ¬</label>
                    <select name="sort_by" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="created_at" {% if sort_by == 'created_at' %}selected{% endif %}>ìµœì‹ ìˆœ</option>
                        <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>ê°€ê²© ë‚®ì€ìˆœ</option>
                        <option value="price_high" {% if sort_by == 'sort_by' == 'price_high' %}selected{% endif %}>ê°€ê²© ë†’ì€ìˆœ</option>
                        <option value="name" {% if sort_by == 'name' %}selected{% endif %}>ì´ë¦„ìˆœ</option>
                    </select>
                </div>
                
                <!-- ê²€ìƒ‰ ë²„íŠ¼ -->
                <div class="flex items-end">
                    <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        ê²€ìƒ‰
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- ìƒí’ˆ ëª©ë¡ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for product in products %}
        <div class="bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow">
            <!-- ìƒí’ˆ ì´ë¯¸ì§€ -->
            <div class="aspect-w-16 aspect-h-9 bg-gray-200 rounded-t-lg">
                {% if product.thumbnail %}
                <img src="{{ product.thumbnail }}" alt="{{ product.name }}" class="w-full h-48 object-cover rounded-t-lg">
                {% else %}
                <div class="w-full h-48 bg-gradient-to-br from-purple-400 to-pink-400 rounded-t-lg flex items-center justify-center">
                    <span class="text-white text-lg font-semibold">{{ product.name[:2] }}</span>
                </div>
                {% endif %}
                
                <!-- ì¶”ì²œ ë°°ì§€ -->
                {% if product.is_featured %}
                <div class="absolute top-2 right-2">
                    <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">ì¶”ì²œ</span>
                </div>
                {% endif %}
            </div>
            
            <!-- ìƒí’ˆ ì •ë³´ -->
            <div class="p-4">
                <h3 class="text-lg font-semibold text-gray-900 mb-2">{{ product.name }}</h3>
                <p class="text-gray-600 text-sm mb-3 line-clamp-2">{{ product.description }}</p>
                
                <!-- ê°€ê²© ì •ë³´ -->
                <div class="flex items-center justify-between mb-4">
                    {% if product.fortune_cost > 0 %}
                    <div class="text-center">
                        <span class="text-lg font-bold text-purple-600">{{ "{:,}".format(product.fortune_cost) }}P</span>
                        <span class="text-sm text-gray-500 block">í¬ì¸íŠ¸</span>
                    </div>
                    {% else %}
                    <div class="text-center">
                        <span class="text-lg font-bold text-blue-600">{{ "{:,}".format(product.price) }}ì›</span>
                        <span class="text-sm text-gray-500 block">í˜„ê¸ˆ</span>
                    </div>
                    {% endif %}
                </div>
                
                <!-- êµ¬ë§¤ ë²„íŠ¼ -->
                <a href="/shop/{{ product.slug }}" 
                   class="block w-full bg-blue-600 text-white text-center py-2 rounded-md hover:bg-blue-700 transition-colors">
                    ìƒì„¸ë³´ê¸°
                </a>
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- ìƒí’ˆì´ ì—†ì„ ë•Œ -->
    {% if not products %}
    <div class="text-center py-12">
        <div class="text-gray-400 text-6xl mb-4">ğŸ”</div>
        <h3 class="text-xl font-semibold text-gray-900 mb-2">ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-600">ë‹¤ë¥¸ ê²€ìƒ‰ ì¡°ê±´ì„ ì‹œë„í•´ë³´ì„¸ìš”.</p>
    </div>
    {% endif %}

    <!-- í˜ì´ì§• -->
    {% if pagination.pages > 1 %}
    <div class="mt-8 flex justify-center">
        <nav class="flex items-center space-x-2">
            <!-- ì´ì „ í˜ì´ì§€ -->
            {% if pagination.page > 1 %}
            <a href="?page={{ pagination.page - 1 }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}" 
               class="px-3 py-2 text-gray-500 hover:text-gray-700">
                â† ì´ì „
            </a>
            {% endif %}
            
            <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
            {% for page_num in range(1, pagination.pages + 1) %}
                {% if page_num == pagination.page %}
                <span class="px-3 py-2 bg-blue-600 text-white rounded-md">{{ page_num }}</span>
                {% elif page_num <= 3 or page_num > pagination.pages - 3 or (page_num >= pagination.page - 1 and page_num <= pagination.page + 1) %}
                <a href="?page={{ page_num }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}" 
                   class="px-3 py-2 text-gray-700 hover:text-blue-600">{{ page_num }}</a>
                {% elif page_num == 4 and pagination.page > 6 %}
                <span class="px-3 py-2 text-gray-500">...</span>
                {% elif page_num == pagination.pages - 3 and pagination.page < pagination.pages - 5 %}
                <span class="px-3 py-2 text-gray-500">...</span>
                {% endif %}
            {% endfor %}
            
            <!-- ë‹¤ìŒ í˜ì´ì§€ -->
            {% if pagination.page < pagination.pages %}
            <a href="?page={{ pagination.page + 1 }}{% if search %}&search={{ search }}{% endif %}{% if category %}&category={{ category }}{% endif %}{% if sort_by %}&sort_by={{ sort_by }}{% endif %}" 
               class="px-3 py-2 text-gray-500 hover:text-gray-700">
                ë‹¤ìŒ â†’
            </a>
            {% endif %}
        </nav>
    </div>
    {% endif %}
</div>

<style>
.line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %} 